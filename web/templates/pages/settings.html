{{ define "views/settings.html"}}
<!--index.html-->

<!--Embed the header.html template at this location-->

{{ template "layouts/header.html" .}}
<style>
.nav-tabs .nav-link.active {
background-color: #0d6efd; /* Primary color */
color: #fff; /* Text color */
border-color: #0d6efd #0d6efd #fff; /* Adjust border for seamless look */
}

.nav-tabs .nav-link {
color: #0d6efd; /* Primary color */
}
</style>
{{ template "layouts/header2.html" .}}
<div class="container">
    <!-- Tabs Navigation -->
    <ul class="nav nav-tabs" id="settingsTabs" role="tablist">
        <li class="nav-item" role="presentation">
            <button class="nav-link active" id="settings-tab" data-bs-toggle="tab" data-bs-target="#settings-content" type="button" role="tab" aria-controls="settings-content" aria-selected="true">
                {{ .lcl.title_settings }}
            </button>
        </li>
        <li class="nav-item" role="presentation">
            <button class="nav-link" id="tables-tab" data-bs-toggle="tab" data-bs-target="#tables-content" type="button" role="tab" aria-controls="tables-content" aria-selected="false">
                {{ .lcl.title_tables }}
            </button>
        </li>
        <li class="nav-item" role="presentation">
            <button class="nav-link" id="logo-tab" data-bs-toggle="tab" data-bs-target="#logo-content" type="button" role="tab" aria-controls="logo-content" aria-selected="false">
                {{ .lcl.set_logo_image }}
            </button>
        </li>
        <li class="nav-item" role="presentation">
            <button class="nav-link" id="streams-tab" data-bs-toggle="tab" data-bs-target="#streams-content" type="button" role="tab" aria-controls="streams-content" aria-selected="false">
                {{ .lcl.title_streams }}
            </button>
        </li>
        <li class="nav-item" role="presentation">
            <a class="nav-link" href="/change-password">{{ .lcl.change_password }}</a>
        </li>
    </ul>

    <!-- Tabs Content -->
    <div class="tab-content" id="settingsTabsContent">
        <!-- Settings Tab -->
        <div class="tab-pane fade show active" id="settings-content" role="tabpanel" aria-labelledby="settings-tab">
            <form id="settingsForm" class="mt-4">
                <!-- AC Infinity Section -->
                <div class="card mb-4 shadow-sm">
                    <div class="card-header bg-primary text-white">
                        <h5 class="card-title mb-0">AC Infinity</h5>
                    </div>
                    <div class="card-body">
                        <div class="form-check form-switch">
                            <input class="form-check-input" type="checkbox" id="aciEnabled" {{ if .settings.ACI.Enabled }}checked{{ end }}>
                            <label class="form-check-label" for="aciEnabled">{{ .lcl.aci_enabled_info }}</label>
                        </div>
                        <div class="d-flex align-items-center mt-3">
                    <span id="tokenSetBadge" class="badge bg-{{ if .settings.ACI.TokenSet }}success{{ else }}danger{{ end }} me-2">
                        {{ if .settings.ACI.TokenSet }}{{ .lcl.token_set }}{{ else }}{{ .lcl.token_not_set }}{{ end }}
                    </span>
                            <button type="button" class="btn btn-secondary btn-sm" data-bs-toggle="modal" data-bs-target="#aciLoginModal">
                                {{ .lcl.retrieve_token }}
                            </button>
                        </div>
                        <small class="text-muted d-block mt-2">
                            {{ .lcl.retrieve_token_desc }}
                        </small>
                    </div>
                </div>

                <!-- EcoWitt Section -->
                <div class="card mb-4 shadow-sm">
                    <div class="card-header bg-success text-white">
                        <h5 class="card-title mb-0">EcoWitt</h5>
                    </div>
                    <div class="card-body">
                        <div class="form-check form-switch">
                            <input class="form-check-input" type="checkbox" id="ecEnabled" {{ if .settings.EC.Enabled }}checked{{ end }}>
                            <label class="form-check-label" for="ecEnabled">{{ .lcl.ecowitt_enabled_info }}</label>
                        </div>
                        <small class="text-muted d-block mt-2">
                            {{ .lcl.ecowitt_enabled_desc }}
                        </small>
                    </div>
                </div>

                <!-- Settings -->
                <div class="card mb-4 shadow-sm">
                    <div class="card-header bg-info text-white">
                        <h5 class="card-title mb-0">{{ .lcl.title_settings }}</h5>
                    </div>
                    <div class="card-body">
                        <div class="form-check form-switch">
                            <input class="form-check-input" type="checkbox" id="guestMode" {{ if .settings.GuestMode }}checked{{ end }}>
                            <label class="form-check-label" for="guestMode">{{ .lcl.guest_mode_info }}</label>
                        </div>
                        <small class="text-muted d-block mt-2">
                            {{ .lcl.guest_mode_desc }}
                        </small>
                    </div>
                    <div class="card-body">
                        <label for="pollingInterval" class="form-label">{{ .lcl.polling_interval }}:
                            <span id="pollingValue" class="fw-bold">{{ .settings.PollingInterval }} {{ .lcl.time_seconds }}</span>
                        </label>
                        <input type="range" class="form-range" id="pollingInterval"
                               min="15" max="300" step="5" value="{{ .settings.PollingInterval }}">
                        <small class="text-muted d-block mt-2">
                            {{ .lcl.polling_interval_desc }}
                        </small>
                    </div>
                </div>

                <script>
                    document.addEventListener("DOMContentLoaded", () => {
                        const pollingSlider = document.getElementById("pollingInterval");
                        const pollingValue = document.getElementById("pollingValue");

                        // Update display when slider is adjusted
                        pollingSlider.addEventListener("input", () => {
                            pollingValue.textContent = `${pollingSlider.value} seconds`;
                        });
                    });
                </script>

                <!-- Save Button -->
                <div class="text-end">
                    <button type="submit" class="btn btn-primary px-4">{{ .lcl.save_settings }}</button>
                </div>
            </form>
        </div>


        <!-- Tables Tab -->
        <div class="tab-pane fade" id="tables-content" role="tabpanel" aria-labelledby="tables-tab">
            <!-- Zones Table -->
            <div class="mt-4">
                <div class="d-flex justify-content-between align-items-center mb-3">
                    <h3 class="text-secondary">{{ .lcl.title_zones }}</h3>
                    <button class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#addZoneModal">
                        <i class="fa-solid fa-plus"></i> {{ .lcl.add_zone }}
                    </button>
                </div>
                <table class="table table-striped table-bordered table-hover">
                    <thead class="table-dark">
                    <tr>
                        <th>{{ .lcl.title_zone }}</th>
                    </tr>
                    </thead>
                    <tbody>
                    {{ range .zones }}
                    <tr class="clickable-row zone-row" data-zone='{{ json . }}'>
                        <td>{{ .Name }}</td>
                    </tr>
                    {{ end }}
                    </tbody>
                </table>
            </div>

            <!-- Activities Table -->
            <div class="mt-4">
                <div class="d-flex justify-content-between align-items-center mb-3">
                    <h3 class="text-secondary">{{ .lcl.title_activities }}</h3>
                    <button class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#addActivityModal">
                        <i class="fa-solid fa-plus"></i> {{ .lcl.add_activity }}
                    </button>
                </div>
                <table class="table table-striped table-bordered table-hover">
                    <thead class="table-dark">
                    <tr>
                        <th>{{ .lcl.title_activity }}</th>
                    </tr>
                    </thead>
                    <tbody>
                    {{ range .activities }}
                    <tr class="clickable-row activity-row" data-activity='{{ json . }}'>
                        <td>{{ .Name }}</td>
                    </tr>
                    {{ end }}
                    </tbody>
                </table>
            </div>

            <!-- Metrics Table -->
            <div class="mt-4">
                <div class="d-flex justify-content-between align-items-center mb-3">
                    <h3 class="text-secondary">{{ .lcl.title_metrics }}</h3>
                    <button class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#addMetricModal">
                        <i class="fa-solid fa-plus"></i> {{ .lcl.add_metric }}
                    </button>
                </div>
                <table class="table table-striped table-bordered table-hover">
                    <thead class="table-dark">
                    <tr>
                        <th>{{ .lcl.title_metric }}</th>
                        <th>{{ .lcl.title_unit }}</th>
                    </tr>
                    </thead>
                    <tbody>
                    {{ range .metrics }}
                    <tr class="clickable-row metric-row" data-metric='{{ json . }}'>
                        <td>{{ .Name }}</td>
                        <td>{{ .Unit }}</td>
                    </tr>
                    {{ end }}
                    </tbody>
                </table>
            </div>

            <!-- Breeders Table -->
            <div class="mt-4">
                <div class="d-flex justify-content-between align-items-center mb-3">
                    <h3 class="text-secondary">{{ .lcl.breeders }}</h3>
                    <button class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#addBreederModal">
                        <i class="fa-solid fa-plus"></i> {{ .lcl.add_breeder }}
                    </button>
                </div>
                <table class="table table-striped table-bordered table-hover">
                    <thead class="table-dark">
                    <tr>
                        <th>{{ .lcl.breeder }}</th>
                    </tr>
                    </thead>
                    <tbody>
                    {{ range .breeders }}
                    <tr class="clickable-row breeder-row" data-breeder='{{ json . }}'>
                        <td>{{ .Name }}</td>
                    </tr>
                    {{ end }}
                    </tbody>
                </table>
            </div>
        </div>

        <!-- Set Logo Tab -->
        <div class="tab-pane fade" id="logo-content" role="tabpanel" aria-labelledby="logo-tab">
            <div class="mt-4">
                <small class="text-muted d-block mt-2">
                    {{ .lcl.add_logo_info }}
                    <p>{{ .lcl.add_logo_note }}</p>
                </small>
                <button class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#uploadImagesModal">
                    <i class="fa-solid fa-upload"></i> {{ .lcl.add_logo }}
                </button>
            </div>
        </div>

        <!-- Streams Tab -->
        <div class="tab-pane fade" id="streams-content" role="tabpanel" aria-labelledby="streams-tab">
            <!-- Streams Table -->
            <div class="mt-4">
                <div class="d-flex justify-content-between align-items-center mb-3">
                    <h3 class="text-secondary">{{ .lcl.title_streams }}</h3>
                    <button class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#addStreamModal">
                        <i class="fa-solid fa-plus"></i> {{ .lcl.add_stream }}
                    </button>
                </div>
                <table class="table table-striped table-bordered table-hover">
                    <thead class="table-dark">
                    <tr>
                        <th>{{ .lcl.stream_name }}</th>
                        <th>{{ .lcl.stream_zone }}</th>
                        <th>{{ .lcl.stream_url }}</th>
                    </tr>
                    </thead>
                    <tbody>
                    {{ range .streams }}
                    <tr class="clickable-row stream-row" data-stream='{{ json . }}'>
                        <td>{{ .Name }}</td>
                        <td>{{ .ZoneName }}</td>
                        <td>{{ .URL }}</td>
                    </tr>
                    {{ end }}
                    </tbody>
                </table>
            </div>
        </div>
    </div>
</div>

<!-- Upload Images Modal -->
<div class="modal fade" id="uploadImagesModal" tabindex="-1" aria-labelledby="uploadImagesModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="uploadImagesModalLabel">{{ .lcl.add_logo }}</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="{{ .lcl.title_close }}"></button>
            </div>
            <div class="modal-body">
                <!-- Drag-and-Drop Area -->
                <div id="dropArea" class="border border-primary rounded p-4 text-center mb-3">
                    <p>{{ .lcl.upload_image_info }}</p>
                    <input type="file" id="logoInput" accept="image/*" style="display: none;">
                </div>
                <div id="logoPreviewContainer" class="text-center">
                    <!-- Preview of the uploaded logo -->
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-primary" id="saveLogoButton">{{ .lcl.save_logo }}</button>
            </div>
        </div>
    </div>
</div>

<!-- AC Infinity Login Modal -->
<div class="modal fade" id="aciLoginModal" tabindex="-1" aria-labelledby="aciLoginModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="aciLoginModalLabel">AC Infinity {{ .lcl.title_login }}</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="{{ .lcl.title_close }}"></button>
            </div>
            <div class="modal-body">
                <form id="aciLoginForm">
                    <div class="mb-3">
                        <label for="aciEmail" class="form-label">{{ .lcl.title_email }}</label>
                        <input type="email" class="form-control" id="aciEmail" placeholder="{{ .lcl.title_aci_email_placeholder }}" required>
                    </div>
                    <div class="mb-3">
                        <label for="aciPassword" class="form-label">{{ .lcl.title_password }}</label>
                        <input type="password" class="form-control" id="aciPassword" placeholder="{{ .lcl.title_aci_password_placeholder }}" required>
                    </div>
                    <button type="submit" class="btn btn-primary">{{ .lcl.title_login }}</button>
                </form>
            </div>
        </div>
    </div>
</div>

<!-- Add Zone Modal -->
<div class="modal fade" id="addZoneModal" tabindex="-1" aria-labelledby="addZoneModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="addZoneModalLabel">{{ .lcl.add_zone }}</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="{{ .lcl.title_close }}"></button>
            </div>
            <div class="modal-body">
                <form id="addZoneForm">
                    <!-- Zone Name Input -->
                    <div class="mb-3">
                        <label for="zoneName" class="form-label">{{ .lcl.zone_name }}</label>
                        <input type="text" class="form-control" id="zoneName" step="any" required>
                    </div>

                    <!-- Submit Button -->
                    <button type="submit" class="btn btn-primary">{{ .lcl.add_zone }}</button>
                </form>
            </div>
        </div>
    </div>
</div>

<!-- Add Activity Modal -->
<div class="modal fade" id="addActivityModal" tabindex="-1" aria-labelledby="addActivityModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="addActivityModalLabel">{{ .lcl.add_activity }}</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="{{ .lcl.title_close }}"></button>
            </div>
            <div class="modal-body">
                <form id="addActivityForm">
                    <!-- Activity Name Input -->
                    <div class="mb-3">
                        <label for="activityName" class="form-label">{{ .lcl.activity_name }}</label>
                        <input type="text" class="form-control" id="activityName" step="any" required>
                    </div>
                    
                    <!-- Submit Button -->
                    <button type="submit" class="btn btn-primary">{{ .lcl.add_activity }}</button>
                </form>
            </div>
        </div>
    </div>
</div>

<!-- Add Metric Modal -->
<div class="modal fade" id="addMetricModal" tabindex="-1" aria-labelledby="addMetricModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="addMetricModalLabel">{{ .lcl.add_metric }}</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="{{ .lcl.title_close }}"></button>
            </div>
            <div class="modal-body">
                <form id="addMetricForm">
                    <!-- Metric Name Input -->
                    <div class="mb-3">
                        <label for="metricName" class="form-label">{{ .lcl.metric_name }}</label>
                        <input type="text" class="form-control" id="metricName" step="any" required>
                    </div>
                    
                    <!-- Metric Unit Input -->
                    <div class="mb-3">
                        <label for="metricUnit" class="form-label">{{ .lcl.metric_unit }}</label>
                        <input type="text" class="form-control" id="metricUnit" step="any" required>
                    </div>
                    
                    <!-- Submit Button -->
                    <button type="submit" class="btn btn-primary">{{ .lcl.add_metric }}</button>
                </form>
            </div>
        </div>
    </div>
</div>

<!-- Add Breeder Modal -->
<div class="modal fade" id="addBreederModal" tabindex="-1" aria-labelledby="addBreederModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="addBreederModalLabel">{{ .lcl.add_breeder }}</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="{{ .lcl.title_close }}"></button>
            </div>
            <div class="modal-body">
                <form id="addBreederForm">
                    <!-- Breeder Name Input -->
                    <div class="mb-3">
                        <label for="breederName" class="form-label">{{ .lcl.breeder_name }}</label>
                        <input type="text" class="form-control" id="breederName" step="any" required>
                    </div>

                    <!-- Submit Button -->
                    <button type="submit" class="btn btn-primary">{{ .lcl.add_breeder }}</button>
                </form>
            </div>
        </div>
    </div>
</div>

<!-- Zone Edit Modal -->
<div class="modal fade" id="editZoneModal" tabindex="-1" aria-labelledby="editZoneModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="editZoneModalLabel">{{ .lcl.edit_zone }}</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="{{ .lcl.title_close }}"></button>
            </div>
            <div class="modal-body">
                <form id="editZoneForm">
                    <input type="hidden" id="zoneId">
                    <div class="mb-3">
                        <label for="editZoneName" class="form-label">{{ .lcl.zone_name }}</label>
                        <input type="text" class="form-control" id="editZoneName" step="any" required>
                    </div>
                    <button type="submit" class="btn btn-primary"><i class="fa-solid fa-floppy-disk"></i> {{ .lcl.save_changes }}</button>
                    <button type="button" class="btn btn-danger" id="deleteZone"><i class="fa-solid fa-trash"></i> {{ .lcl.delete_zone }}</button>
                </form>
            </div>
        </div>
    </div>
</div>

<!-- Activity Edit Modal -->
<div class="modal fade" id="editActivityModal" tabindex="-1" aria-labelledby="editActivityModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="editActivityModalLabel">{{ .lcl.edit_activity }}</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="{{ .lcl.title_close }}"></button>
            </div>
            <div class="modal-body" id="editActivityModalBody">
                <form id="editActivityForm">
                    <input type="hidden" id="activityId">
                    <div class="mb-3">
                        <label for="editActivityName" class="form-label">{{ .lcl.activity_name }}</label>
                        <input type="text" class="form-control" id="editActivityName" step="any" required>
                    </div>
                    <button type="submit" class="btn btn-primary"><i class="fa-solid fa-floppy-disk"></i> {{ .lcl.save_changes }}</button>
                    <button type="button" class="btn btn-danger" id="deleteActivity"><i class="fa-solid fa-trash"></i> {{ .lcl.delete_activity }}</button>
                </form>
            </div>
        </div>
    </div>
</div>

<!-- Metric Edit Modal -->
<div class="modal fade" id="editMetricModal" tabindex="-1" aria-labelledby="editMetricModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="editMetricModalLabel">{{ .lcl.edit_metric }}</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="{{ .lcl.title_close }}"></button>
            </div>
            <div class="modal-body" id="editMetricModalBody">
                <form id="editMetricForm">
                    <input type="hidden" id="metricId">
                    <div class="mb-3">
                        <label for="editMetricName" class="form-label">{{ .lcl.metric_name }}</label>
                        <input type="text" class="form-control" id="editMetricName" step="any" required>
                    </div>
                    <div class="mb-3">
                        <label for="editMetricUnit" class="form-label">{{ .lcl.metric_unit }}</label>
                        <input type="text" class="form-control" id="editMetricUnit" step="any" required>
                    </div>
                    <button type="submit" class="btn btn-primary"><i class="fa-solid fa-floppy-disk"></i> {{ .lcl.save_changes }}</button>
                    <button type="button" class="btn btn-danger" id="deleteMetric"><i class="fa-solid fa-trash"></i> {{ .lcl.delete_metric }}</button>
                </form>
            </div>
        </div>
    </div>
</div>

<!-- Breeder Edit Modal -->
<div class="modal fade" id="editBreederModal" tabindex="-1" aria-labelledby="editBreederModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="editBreederModalLabel">{{ .lcl.edit_breeder }}</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="{{ .lcl.title_close }}"></button>
            </div>
            <div class="modal-body" id="editBreederModalBody">
                <form id="editBreederForm">
                    <input type="hidden" id="breederId">
                    <div class="mb-3">
                        <label for="editBreederName" class="form-label">{{ .lcl.breeder_name }}</label>
                        <input type="text" class="form-control" id="editBreederName" step="any" required>
                    </div>
                    <button type="submit" class="btn btn-primary"><i class="fa-solid fa-floppy-disk"></i> {{ .lcl.save_changes }}</button>
                    <button type="button" class="btn btn-danger" id="deleteBreeder"><i class="fa-solid fa-trash"></i> {{ .lcl.delete_breeder }}</button>
                </form>
            </div>
        </div>
    </div>
</div>

<!-- Add Stream Modal -->
<div class="modal fade" id="addStreamModal" tabindex="-1" aria-labelledby="addStreamModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="addStreamModalLabel">{{ .lcl.add_stream }}</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="{{ .lcl.title_close }}"></button>
            </div>
            <div class="modal-body">
                <form id="addStreamForm">
                    <!-- Stream Name Input -->
                    <div class="mb-3">
                        <label for="streamName" class="form-label">{{ .lcl.stream_name }}</label>
                        <input type="text" class="form-control" id="streamName" step="any" required>
                    </div>
                    <!-- Stream Zone Input -->
                    <div class="mb-3">
                        <label for="streamZone" class="form-label">{{ .lcl.stream_zone }}</label>
                        <select class="form-select" id="streamZone" required>
                            <option value="" selected disabled>{{ .lcl.select_zone }}</option>
                            {{ range .zones }}
                            <option value="{{ .ID }}">{{ .Name }}</option>
                            {{ end }}
                        </select>
                    </div>
                    <!-- Stream URL Input -->
                    <div class="mb-3">
                        <label for="streamURL" class="form-label">{{ .lcl.stream_url }}</label>
                        <input type="text" class="form-control" id="streamURL" step="any" required>
                    </div>
                    <!-- Capture Interval -->
                    <!-- 5 - 360 minutes, 5 minute increments -->
                    <div class="mb-3">
                        <label for="streamInterval" class="form-label">{{ .lcl.capture_interval }}</label>
                        <input type="number" class="form-control" id="streamInterval" min="5" max="360" step="5" required>
                    </div>

                    <!-- Submit Button -->
                    <button type="submit" class="btn btn-primary">{{ .lcl.add_stream }}</button>
                </form>
            </div>
        </div>
    </div>
</div>

<!-- Edit Stream Modal -->
<div class="modal fade" id="editStreamModal" tabindex="-1" aria-labelledby="editStreamModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="editStreamModalLabel">{{ .lcl.edit_stream }}</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="{{ .lcl.title_close }}"></button>
            </div>
            <div class="modal-body">
                <form id="editStreamForm">
                    <input type="hidden" id="streamId">
                    <div class="mb-3">
                        <label for="editStreamName" class="form-label">{{ .lcl.stream_name }}</label>
                        <input type="text" class="form-control" id="editStreamName" step="any" required>
                    </div>
                    <div class="mb-3">
                        <label for="editStreamZone" class="form-label">{{ .lcl.stream_zone }}</label>
                        <select class="form-select" id="editStreamZone" required>
                            <option value="" selected disabled>{{ .lcl.select_zone }}</option>
                            {{ range .zones }}
                            <option value="{{ .ID }}">{{ .Name }}</option>
                            {{ end }}
                        </select>
                    </div>
                    <div class="mb-3">
                        <label for="editStreamURL" class="form-label">{{ .lcl.stream_url }}</label>
                        <input type="text" class="form-control" id="editStreamURL" step="any" required>
                    </div>
                    <div class="mb-3">
                        <label for="editStreamInterval" class="form-label">{{ .lcl.capture_interval }}</label>
                        <input type="number" class="form-control" id="editStreamInterval" min="5" max="360" step="5" required>
                    </div>
                    <button type="submit" class="btn btn-primary"><i class="fa-solid fa-floppy-disk"></i> {{ .lcl.save_changes }}</button>
                    <button type="button" class="btn btn-danger" id="deleteStream"><i class="fa-solid fa-trash"></i> {{ .lcl.delete_stream }}</button>
                </form>
            </div>
        </div>
    </div>
</div>

<script>
    document.addEventListener("DOMContentLoaded", () => {
        const addStreamForm = document.getElementById("addStreamForm");
        const addStreamModal = document.getElementById("addStreamModal");

        addStreamForm.addEventListener("submit", (e) => {
            e.preventDefault();

            // Gather form data
            const streamName = document.getElementById("streamName").value;
            const streamZone = document.getElementById("streamZone").value;
            const streamURL = document.getElementById("streamURL").value;
            const streamInterval = document.getElementById("streamInterval").value;

            // Construct the payload
            const payload = {
                stream_name: streamName,
                zone_id: streamZone,
                url: streamURL,
                interval: streamInterval,
            };

            // Send POST request to /streams
            fetch("/streams", {
                method: "POST",
                headers: {
                    "Content-Type": "application/json",
                },
                body: JSON.stringify(payload),
            })
                .then((response) => {
                    if (!response.ok) {
                        throw new Error("Failed to add stream");
                    }
                    return response.json();
                })
                .then((data) => {
                    // Success: Close modal and reload page
                    const modal = bootstrap.Modal.getInstance(document.getElementById("addStreamModal"));
                    modal.hide();
                    window.location.reload(); // Refresh page to show updated data
                })
                .catch((error) => {
                    console.error("Error:", error);
                    alert("Failed to add stream");
                });

        })
    })

    document.addEventListener("DOMContentLoaded", () => {
        const form = document.getElementById("addZoneForm");
        const addZoneModal = document.getElementById("addZoneModal");

        form.addEventListener("submit", (e) => {
            e.preventDefault();

            // Gather form data
            const zoneId = document.getElementById("zoneId").value;
            const zoneName = document.getElementById("zoneName").value;

            // Construct the payload
            const payload = {
                zone_name: zoneName,
            };

            //alert(JSON.stringify(payload));

            // Send POST request to /plantMeasurement
            fetch("/zones", {
                method: "POST",
                headers: {
                    "Content-Type": "application/json",
                },
                body: JSON.stringify(payload),
            })
                .then((response) => {
                    if (!response.ok) {
                        throw new Error("Failed to add zone");
                    }
                    return response.json();
                })
                .then((data) => {
                    // Success: Close modal and reload page
                    const modal = bootstrap.Modal.getInstance(document.getElementById("addZoneModal"));
                    modal.hide();
                    window.location.reload(); // Refresh page to show updated data
                })
                .catch((error) => {
                    console.error("Error:", error);
                    alert("{{ .lcl.failed_to_add_zone }}");
                });
        });
    });

    document.addEventListener("DOMContentLoaded", () => {
        const editZoneModal = new bootstrap.Modal(document.getElementById("editZoneModal"));
        const zoneForm = document.getElementById("editZoneForm");
        const deleteZoneButton = document.getElementById("deleteZone");

        document.querySelectorAll(".zone-row").forEach(row => {
            row.addEventListener("click", () => {
                const zoneData = JSON.parse(row.getAttribute("data-zone"));

                document.getElementById("zoneId").value = zoneData.id;
                document.getElementById("editZoneName").value = zoneData.name;

                editZoneModal.show();
            });
        });

        zoneForm.addEventListener("submit", (e) => {
            e.preventDefault();
            const zoneId = document.getElementById("zoneId").value;
            const payload = {
                zone_name: document.getElementById("editZoneName").value,
            };

            fetch(`/zones/${zoneId}`, {
                method: "PUT",
                headers: { "Content-Type": "application/json" },
                body: JSON.stringify(payload),
            })
                .then(response => response.json())
                .then(() => location.reload())
                .catch(err => alert("{{ .lcl.failed_to_update_zone }}"));
        });

        deleteZoneButton.addEventListener("click", () => {
            const zoneId = document.getElementById("zoneId").value;

            if (confirm("{{ .lcl.delete_zone_confirm }}")) {
                fetch(`/zones/${zoneId}`, { method: "DELETE" })
                    .then(response => response.json())
                    .then(() => location.reload())
                    .catch(err => alert("{{ .lcl.failed_to_delete_zone }}"));
            }
        });
    });
</script>

<script>
    document.addEventListener("DOMContentLoaded", () => {
        const aciLoginForm = document.getElementById("aciLoginForm");

        aciLoginForm.addEventListener("submit", (e) => {
            e.preventDefault();

            const email = document.getElementById("aciEmail").value;
            const password = document.getElementById("aciPassword").value;

            fetch("/aci/login", {
                method: "POST",
                headers: {
                    "Content-Type": "application/json",
                },
                body: JSON.stringify({ email, password }),
            })
                .then((response) => response.json())
                .then((data) => {
                    if (data.success) {
                        const modal = bootstrap.Modal.getInstance(document.getElementById("aciLoginModal"));
                        modal.hide();
                        document.getElementById("tokenSetBadge").textContent = "{{ .lcl.token_set }}";
                        document.getElementById("tokenSetBadge").classList.remove("bg-danger");
                        document.getElementById("tokenSetBadge").classList.add("bg-success");
                        //alert("Token fetched successfully!");
                    } else {
                        alert("{{ .lcl.failed_to_fetch_token }}: " + data.message);
                    }
                })
                .catch((error) => {
                    console.error("{{ .lcl.error_fetching_token }}", error);
                    alert("{{ .lcl.generic_error }}");
                });
        });
    });


    document.addEventListener("DOMContentLoaded", () => {
        const form = document.getElementById("settingsForm");

        form.addEventListener("submit", (e) => {
            e.preventDefault();

            // Gather form data
            const settings = {
                aci: {
                    enabled: document.getElementById("aciEnabled").checked,
                },
                ec: {
                    enabled: document.getElementById("ecEnabled").checked,
                },
                polling_interval: document.getElementById("pollingInterval").value,
                guest_mode: document.getElementById("guestMode").checked,
            };

            // Send POST request to save settings
            fetch("/settings", {
                method: "POST",
                headers: {
                    "Content-Type": "application/json",
                },
                body: JSON.stringify(settings),
            })
                .then((response) => {
                    if (!response.ok) {
                        throw new Error("{{ .lcl.failed_to_save_settings }}");
                    }
                    alert("Settings saved successfully!");
                })
                .catch((error) => {
                    console.error("Error:", error);
                    alert("{{ .lcl.failed_to_save_settings }}");
                });
        });
    });

</script>

<script>
    document.addEventListener("DOMContentLoaded", () => {
        const form = document.getElementById("addActivityForm");
        const addActivityModal = document.getElementById("addActivityModal");

        form.addEventListener("submit", (e) => {
            e.preventDefault();

            // Gather form data
            const activityId = document.getElementById("activityId").value;
            const activityName = document.getElementById("activityName").value;

            // Construct the payload
            const payload = {
                activity_name: activityName,
            };

            //alert(JSON.stringify(payload));

            // Send POST request to /plantMeasurement
            fetch("/activities", {
                method: "POST",
                headers: {
                    "Content-Type": "application/json",
                },
                body: JSON.stringify(payload),
            })
                .then((response) => {
                    if (!response.ok) {
                        throw new Error("{{ .lcl.failed_to_add_activity }}");
                    }
                    return response.json();
                })
                .then((data) => {
                    // Success: Close modal and reload page
                    const modal = bootstrap.Modal.getInstance(document.getElementById("addActivityModal"));
                    modal.hide();
                    window.location.reload(); // Refresh page to show updated data
                })
                .catch((error) => {
                    console.error("Error:", error);
                    alert("{{ .lcl.failed_to_add_activity }}");
                });
        });
    });

    document.addEventListener("DOMContentLoaded", () => {
        const editActivityModal = new bootstrap.Modal(document.getElementById("editActivityModal"));
        const activityForm = document.getElementById("editActivityForm");
        const deleteActivityButton = document.getElementById("deleteActivity");

        document.querySelectorAll(".activity-row").forEach(row => {
            row.addEventListener("click", () => {
                const activityData = JSON.parse(row.getAttribute("data-activity"));

                document.getElementById("activityId").value = activityData.id;
                document.getElementById("editActivityName").value = activityData.name;

                editActivityModal.show();
            });
        });

        activityForm.addEventListener("submit", (e) => {
            e.preventDefault();
            const activityId = document.getElementById("activityId").value;
            const payload = {
                activity_name: document.getElementById("editActivityName").value,
            };

            fetch(`/activities/${activityId}`, {
                method: "PUT",
                headers: { "Content-Type": "application/json" },
                body: JSON.stringify(payload),
            })
                .then(response => response.json())
                .then(() => location.reload())
                .catch(err => alert("{{ .lcl.failed_to_update_activity }}"));
        });

        deleteActivityButton.addEventListener("click", () => {
            const activityId = document.getElementById("activityId").value;

            if (confirm("{{ .lcl.delete_activity_confirm }}")) {
                fetch(`/activities/${activityId}`, { method: "DELETE" })
                    .then(response => response.json())
                    .then(() => location.reload())
                    .catch(err => alert("{{ .lcl.failed_to_delete_activity }}"));
            }
        });
    });

    document.addEventListener("DOMContentLoaded", ()=> {
        const editStreamModal = new bootstrap.Modal(document.getElementById("editStreamModal"));
        const streamForm = document.getElementById("editStreamForm");
        const deleteStreamButton = document.getElementById("deleteStream");

        document.querySelectorAll(".stream-row").forEach(row => {
            row.addEventListener("click", () => {
                const streamData = JSON.parse(row.getAttribute("data-stream"));

                document.getElementById("streamId").value = streamData.id;
                document.getElementById("editStreamName").value = streamData.name;
                document.getElementById("editStreamZone").value = streamData.zone_id;
                document.getElementById("editStreamURL").value = streamData.url;
                document.getElementById("editStreamInterval").value = streamData.capture_interval;

                editStreamModal.show();
            });
        });

        streamForm.addEventListener("submit", (e) => {
            e.preventDefault();
            const streamId = document.getElementById("streamId").value;
            const payload = {
                stream_name: document.getElementById("editStreamName").value,
                zone_id: document.getElementById("editStreamZone").value,
                url: document.getElementById("editStreamURL").value,
                interval: document.getElementById("editStreamInterval").value,
            };

            fetch(`/streams/${streamId}`, {
                method: "PUT",
                headers: { "Content-Type": "application/json" },
                body: JSON.stringify(payload),
            })
                .then(response => response.json())
                .then(() => location.reload())
                .catch(err => alert("{{ .lcl.failed_to_update_stream }}"));
        });

        deleteStreamButton.addEventListener("click", () => {
            const streamId = document.getElementById("streamId").value;

            if (confirm("{{ .lcl.delete_stream_confirm }}")) {
                fetch(`/streams/${streamId}`, { method: "DELETE" })
                    .then(response => response.json())
                    .then(() => location.reload())
                    .catch(err => alert("{{ .lcl.failed_to_delete_stream }}"));
            }
        });
    });
</script>


<script>
    document.addEventListener("DOMContentLoaded", () => {
        const form = document.getElementById("addMetricForm");
        const addMetricModal = document.getElementById("addMetricModal");

        form.addEventListener("submit", (e) => {
            e.preventDefault();

            // Gather form data
            const metricId = document.getElementById("metricId").value;
            const metricName = document.getElementById("metricName").value;
            const metricUnit = document.getElementById("metricUnit").value;

            // Construct the payload
            const payload = {
                metric_name: metricName,
                metric_unit: metricUnit,
            };

            //alert(JSON.stringify(payload));

            // Send POST request to /plantMeasurement
            fetch("/metrics", {
                method: "POST",
                headers: {
                    "Content-Type": "application/json",
                },
                body: JSON.stringify(payload),
            })
                .then((response) => {
                    if (!response.ok) {
                        throw new Error("{{ .lcl.failed_to_add_metric }}");
                    }
                    return response.json();
                })
                .then((data) => {
                    // Success: Close modal and reload page
                    const modal = bootstrap.Modal.getInstance(document.getElementById("addMetricModal"));
                    modal.hide();
                    window.location.reload(); // Refresh page to show updated data
                })
                .catch((error) => {
                    console.error("Error:", error);
                    alert("{{ .lcl.failed_to_add_metric }}");
                });
        });
    });

    document.addEventListener("DOMContentLoaded", () => {
        const editMetricModal = new bootstrap.Modal(document.getElementById("editMetricModal"));
        const metricForm = document.getElementById("editMetricForm");
        const deleteMetricButton = document.getElementById("deleteMetric");

        document.querySelectorAll(".metric-row").forEach(row => {
            row.addEventListener("click", () => {
                const metricData = JSON.parse(row.getAttribute("data-metric"));

                document.getElementById("metricId").value = metricData.id;
                document.getElementById("editMetricName").value = metricData.name;
                document.getElementById("editMetricUnit").value = metricData.unit;

                editMetricModal.show();
            });
        });

        metricForm.addEventListener("submit", (e) => {
            e.preventDefault();
            const metricId = document.getElementById("metricId").value;
            const payload = {
                metric_name: document.getElementById("editMetricName").value,
                metric_unit: document.getElementById("editMetricUnit").value,
            };

            fetch(`/metrics/${metricId}`, {
                method: "PUT",
                headers: { "Content-Type": "application/json" },
                body: JSON.stringify(payload),
            })
                .then(response => response.json())
                .then(() => location.reload())
                .catch(err => alert("{{ .lcl.failed_to_update_metric }}"));
        });

        deleteMetricButton.addEventListener("click", () => {
            const metricId = document.getElementById("metricId").value;

            if (confirm("{{ .lcl.delete_metric_confirm }}")) {
                fetch(`/metrics/${metricId}`, { method: "DELETE" })
                    .then(response => response.json())
                    .then(() => location.reload())
                    .catch(err => alert("{{ .lcl.failed_to_delete_metric }}"));
            }
        });
    });
</script>


<script>
    document.addEventListener("DOMContentLoaded", () => {
        const form = document.getElementById("addBreederForm");
        const addBreederModal = document.getElementById("addBreederModal");

        form.addEventListener("submit", (e) => {
            e.preventDefault();

            // Gather form data
            const breederId = document.getElementById("breederId").value;
            const breederName = document.getElementById("breederName").value;

            // Construct the payload
            const payload = {
                breeder_name: breederName,
            };

            //alert(JSON.stringify(payload));

            // Send POST request to /plantMeasurement
            fetch("/breeders", {
                method: "POST",
                headers: {
                    "Content-Type": "application/json",
                },
                body: JSON.stringify(payload),
            })
                .then((response) => {
                    if (!response.ok) {
                        throw new Error("{{ .lcl.failed_to_add_breeder }}");
                    }
                    return response.json();
                })
                .then((data) => {
                    // Success: Close modal and reload page
                    const modal = bootstrap.Modal.getInstance(document.getElementById("addBreederModal"));
                    modal.hide();
                    window.location.reload(); // Refresh page to show updated data
                })
                .catch((error) => {
                    console.error("Error:", error);
                    alert("{{ .lcl.failed_to_add_breeder }}");
                });
        });
    });

    document.addEventListener("DOMContentLoaded", () => {
        const editBreederModal = new bootstrap.Modal(document.getElementById("editBreederModal"));
        const breederForm = document.getElementById("editBreederForm");
        const deleteBreederButton = document.getElementById("deleteBreeder");

        document.querySelectorAll(".breeder-row").forEach(row => {
            row.addEventListener("click", () => {
                const breederData = JSON.parse(row.getAttribute("data-breeder"));

                document.getElementById("breederId").value = breederData.id;
                document.getElementById("editBreederName").value = breederData.name;

                editBreederModal.show();
            });
        });

        breederForm.addEventListener("submit", (e) => {
            e.preventDefault();
            const breederId = document.getElementById("breederId").value;
            const payload = {
                breeder_name: document.getElementById("editBreederName").value,
            };

            fetch(`/breeders/${breederId}`, {
                method: "PUT",
                headers: { "Content-Type": "application/json" },
                body: JSON.stringify(payload),
            })
                .then(response => response.json())
                .then(() => location.reload())
                .catch(err => alert("{{ .lcl.failed_to_update_breeder }}"));
        });

        deleteBreederButton.addEventListener("click", () => {
            const breederId = document.getElementById("breederId").value;

            if (confirm("{{ .lcl.delete_breeder_confirm }}")) {
                fetch(`/breeders/${breederId}`, { method: "DELETE" })
                    .then(response => response.json())
                    .then(() => location.reload())
                    .catch(err => alert("{{ .lcl.failed_to_delete_breeder }}"));
            }
        });
    });
</script>

<script>
    document.addEventListener("DOMContentLoaded", () => {
        const dropArea = document.getElementById("dropArea");
        const logoInput = document.getElementById("logoInput");
        const logoPreviewContainer = document.getElementById("logoPreviewContainer");
        const saveLogoButton = document.getElementById("saveLogoButton");

        dropArea.addEventListener("click", () => {
            logoInput.click();
        });

        logoInput.addEventListener("change", (e) => {
            const file = e.target.files[0];
            if (file) {
                const reader = new FileReader();
                reader.onload = (event) => {
                    logoPreviewContainer.innerHTML = `<img src="${event.target.result}" class="img-fluid" alt="Preview">`;
                };
                reader.readAsDataURL(file);
            }
        });

        saveLogoButton.addEventListener("click", () => {
            const file = logoInput.files[0];
            if (file) {
                const formData = new FormData();
                formData.append("logo", file);

                fetch("/settings/upload-logo", {
                    method: "POST",
                    body: formData,
                })
                    .then((response) => {
                        if (response.ok) {
                            alert("{{ .lcl.logo_uploaded_successfully }}");
                            location.reload();
                        } else {
                            alert("{{ .lcl.error_uploading_logo }}");
                        }
                    })
                    .catch((error) => {
                        console.error("Error:", error);
                        alert("{{ .lcl.error_uploading_logo }}");
                    });
            } else {
                alert("{{ .lcl.select_logo_image }}");
            }
        });
    });
</script>

<!--Embed the footer.html template at this location-->
{{ template "layouts/footer.html" .}}

{{ end }}