{{ define "views/plants.html"}}
<!--index.html-->

<!--Embed the header.html template at this location-->
{{ template "common/header.html" .}}
{{ template "common/header2.html" .}}


<header class="masthead text-center">
    <div class="overlay"></div>


    <div class="container">
        <div class="mb-4">
            <!-- View Selector -->
            <div class="mb-4 d-flex justify-content-between align-items-center">
                <div class="btn-group" role="group">
                    <button class="btn view-button active" data-view="living">{{ .lcl.living_plants }}</button>
                    <button class="btn view-button" data-view="harvested">{{ .lcl.harvested_plants }}</button>
                    <button class="btn view-button" data-view="dead">{{ .lcl.dead_plants }}</button>
                </div>
                <div class="d-flex align-items-center">
                    <div class="input-group">
                        <span class="input-group-text"><i class="fa-solid fa-search"></i></span>
                        <input type="text" class="form-control" id="searchPlants" placeholder="{{ .lcl.search_plants }}...">
                    </div>
                    {{ if .loggedIn }}
                    <button class="btn btn-success ms-3" data-bs-toggle="modal" data-bs-target="#addPlantModal">
                        <i class="fa-solid fa-plus"></i>
                    </button>
                    {{ end }}
                </div>
            </div>

        </div>

        <div class="row">
            <div class="col-12">
                <table class="table table-striped table-bordered table-hover">
                    <thead class="table-dark" id="plantsTableHeader">
                    <tr>
                        <th scope="col" data-sort="name" data-type="text" class="sortable">{{ .lcl.title_plant }} <i class="fa-solid fa-sort"></i><i class="fa-solid fa-sort-up"></i><i class="fa-solid fa-sort-down"></i></th>
                        <th scope="col" data-sort="strain_name" data-type="text" class="sortable">{{ .lcl.title_strain }} <i class="fa-solid fa-sort"></i><i class="fa-solid fa-sort-up"></i><i class="fa-solid fa-sort-down"></i></th>
                        <th scope="col" data-sort="breeder_name" data-type="text" class="sortable">{{ .lcl.breeder }} <i class="fa-solid fa-sort"></i><i class="fa-solid fa-sort-up"></i><i class="fa-solid fa-sort-down"></i></th>
                        <th scope="col" data-sort="status" data-type="text" class="sortable">{{ .lcl.title_status }} <i class="fa-solid fa-sort"></i><i class="fa-solid fa-sort-up"></i><i class="fa-solid fa-sort-down"></i></th>
                        <th scope="col" data-sort="start_date" data-type="date" class="sortable">{{ .lcl.start_date }} <i class="fa-solid fa-sort"></i><i class="fa-solid fa-sort-up"></i><i class="fa-solid fa-sort-down"></i></th>
                        <th scope="col" id="dynamicHeader1" class="sortable">{{ .lcl.current_week }} <i class="fa-solid fa-sort"></i><i class="fa-solid fa-sort-up"></i><i class="fa-solid fa-sort-down"></i></th>
                        <th scope="col" id="dynamicHeader2" class="sortable">{{ .lcl.current_day }} <i class="fa-solid fa-sort"></i><i class="fa-solid fa-sort-up"></i><i class="fa-solid fa-sort-down"></i></th>
                        {{ if .loggedIn }}
                        <th scope="col"></th>
                        {{ end }}
                    </tr>
                    </thead>
                    <tbody id="plantsTableBody">
                    <!-- Rows populated dynamically -->
                    </tbody>
                </table>
            </div>
        </div>
    </div>
</header>

<!-- Add Plant Modal -->
{{ template "modals/add-plant-modal.html" .}}

{{ if .loggedIn }}
<div class="modal fade" id="quickStatusModal" tabindex="-1" aria-labelledby="quickStatusModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="quickStatusModalLabel">{{ .lcl.change_status }}</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="{{ .lcl.title_close }}"></button>
            </div>
            <div class="modal-body">
                <form id="quickStatusForm">
                    <input type="hidden" id="quickStatusPlantId">
                    <div class="mb-3">
                        <label for="quickStatusPlantName" class="form-label">{{ .lcl.plant_name }}</label>
                        <input type="text" class="form-control" id="quickStatusPlantName" readonly>
                    </div>
                    <div class="mb-3">
                        <label for="quickStatusSelect" class="form-label">{{ .lcl.title_status }}</label>
                        <select class="form-select" id="quickStatusSelect" required>
                            {{ range .statuses }}
                            {{ $lbl := index $.lcl (print (lower .Status) "_label") }}
                            <option value="{{ .ID }}">{{ if $lbl }}{{ $lbl }}{{ else }}{{ .Status }}{{ end }}</option>
                            {{ end }}
                        </select>
                    </div>
                    <div class="mb-3">
                        <label for="quickStatusDate" class="form-label">{{ .lcl.effective_date }}</label>
                        <input type="datetime-local" class="form-control" id="quickStatusDate" required value="{{ now | formatDateTimeLocal }}">
                    </div>
                    <button type="submit" class="btn btn-primary">{{ .lcl.change_status }}</button>
                </form>
            </div>
        </div>
    </div>
</div>

<div class="modal fade" id="quickMeasurementModal" tabindex="-1" aria-labelledby="quickMeasurementModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="quickMeasurementModalLabel">{{ .lcl.add_measurement }}</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="{{ .lcl.title_close }}"></button>
            </div>
            <div class="modal-body">
                <form id="quickMeasurementForm">
                    <input type="hidden" id="quickMeasurementPlantId">
                    <div class="mb-3">
                        <label for="quickMeasurementPlantName" class="form-label">{{ .lcl.plant_name }}</label>
                        <input type="text" class="form-control" id="quickMeasurementPlantName" readonly>
                    </div>
                    <div class="mb-3">
                        <label for="quickMeasurementMetric" class="form-label">{{ .lcl.measurement_name }}</label>
                        <select class="form-select" id="quickMeasurementMetric" required>
                            {{ range .measurements }}
                            <option value="{{ .ID }}">{{ .Name }}</option>
                            {{ end }}
                        </select>
                    </div>
                    <div class="mb-3">
                        <label for="quickMeasurementValue" class="form-label">{{ .lcl.measurement_value }}</label>
                        <input type="number" class="form-control" id="quickMeasurementValue" step="any" required>
                    </div>
                    <div class="mb-3">
                        <label for="quickMeasurementDate" class="form-label">{{ .lcl.title_date }}</label>
                        <input type="datetime-local" class="form-control" id="quickMeasurementDate" required value="{{ now | formatDateTimeLocal }}">
                    </div>
                    <button type="submit" class="btn btn-primary">{{ .lcl.add_measurement }}</button>
                </form>
            </div>
        </div>
    </div>
</div>

<div class="modal fade" id="quickActivityModal" tabindex="-1" aria-labelledby="quickActivityModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="quickActivityModalLabel">{{ .lcl.add_activity }}</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="{{ .lcl.title_close }}"></button>
            </div>
            <div class="modal-body">
                <form id="quickActivityForm">
                    <input type="hidden" id="quickActivityPlantId">
                    <div class="mb-3">
                        <label for="quickActivityPlantName" class="form-label">{{ .lcl.plant_name }}</label>
                        <input type="text" class="form-control" id="quickActivityPlantName" readonly>
                    </div>
                    <div class="mb-3">
                        <label for="quickActivityName" class="form-label">{{ .lcl.activity_name }}</label>
                        <select class="form-select" id="quickActivityName" required>
                            {{ range .activities }}
                            <option value="{{ .ID }}">{{ .Name }}</option>
                            {{ end }}
                        </select>
                    </div>
                    <div class="mb-3">
                        <label for="quickActivityNote" class="form-label">{{ .lcl.activity_note }}</label>
                        <textarea class="form-control" id="quickActivityNote" rows="3"></textarea>
                    </div>
                    <div class="mb-3">
                        <label for="quickActivityDate" class="form-label">{{ .lcl.title_date }}</label>
                        <input type="datetime-local" class="form-control" id="quickActivityDate" required value="{{ now | formatDateTimeLocal }}">
                    </div>
                    <button type="submit" class="btn btn-primary">{{ .lcl.add_activity }}</button>
                </form>
            </div>
        </div>
    </div>
</div>
{{ end }}

<script>
    document.addEventListener("DOMContentLoaded", () => {
        const plantsTableBody = document.getElementById("plantsTableBody");
        const searchPlants = document.getElementById("searchPlants");
        const viewButtons = document.querySelectorAll(".view-button");
        const headerDynamic1 = document.getElementById("dynamicHeader1");
        const headerDynamic2 = document.getElementById("dynamicHeader2");
        const statusOptionsRaw = {{ json .statuses }};
        const parsedStatusOptions = typeof statusOptionsRaw === "string"
            ? JSON.parse(statusOptionsRaw || "[]")
            : statusOptionsRaw;
        const statusOptions = Array.isArray(parsedStatusOptions) ? parsedStatusOptions : [];
        const canEditStatus = {{ if .loggedIn }}true{{ else }}false{{ end }};
        const statusIdByName = new Map(statusOptions.map(status => [status.status, status.id]));
        const statusUpdateError = "{{ .lcl.failed_to_change_status }}";
        const measurementAddError = "{{ .lcl.failed_to_add_measurement }}";
        const activityAddError = "{{ .lcl.failed_to_add_activity }}";
        const quickStatusModalElement = document.getElementById("quickStatusModal");
        const quickStatusForm = document.getElementById("quickStatusForm");
        const quickStatusPlantIdInput = document.getElementById("quickStatusPlantId");
        const quickStatusPlantNameInput = document.getElementById("quickStatusPlantName");
        const quickStatusSelect = document.getElementById("quickStatusSelect");
        const quickStatusDate = document.getElementById("quickStatusDate");
        const quickStatusModal = quickStatusModalElement && window.bootstrap
            ? new bootstrap.Modal(quickStatusModalElement)
            : null;
        const quickMeasurementModalElement = document.getElementById("quickMeasurementModal");
        const quickMeasurementForm = document.getElementById("quickMeasurementForm");
        const quickMeasurementPlantIdInput = document.getElementById("quickMeasurementPlantId");
        const quickMeasurementPlantNameInput = document.getElementById("quickMeasurementPlantName");
        const quickMeasurementMetric = document.getElementById("quickMeasurementMetric");
        const quickMeasurementValue = document.getElementById("quickMeasurementValue");
        const quickMeasurementDate = document.getElementById("quickMeasurementDate");
        const quickMeasurementModal = quickMeasurementModalElement && window.bootstrap
            ? new bootstrap.Modal(quickMeasurementModalElement)
            : null;
        const quickActivityModalElement = document.getElementById("quickActivityModal");
        const quickActivityForm = document.getElementById("quickActivityForm");
        const quickActivityPlantIdInput = document.getElementById("quickActivityPlantId");
        const quickActivityPlantNameInput = document.getElementById("quickActivityPlantName");
        const quickActivityName = document.getElementById("quickActivityName");
        const quickActivityNote = document.getElementById("quickActivityNote");
        const quickActivityDate = document.getElementById("quickActivityDate");
        const quickActivityModal = quickActivityModalElement && window.bootstrap
            ? new bootstrap.Modal(quickActivityModalElement)
            : null;
        let currentView = "living";
        let plantsData = [];
        let sortColumn = null;
        let sortDirection = "asc";

        const setActiveButton = (clickedButton) => {
            viewButtons.forEach(button => {
                if (button === clickedButton) {
                    button.classList.add("active"); // Add active class to clicked button
                } else {
                    button.classList.remove("active"); // Remove active class from others
                }
            });
        };

        const fetchPlants = (view) => {
            fetch(`/plants/${view}`)
                .then(response => response.json())
                .then(data => {
                    plantsData = data;
                    updateHeaders(view);
                    updateTable();
                })
                .catch(err => console.error("Error fetching plants:", err));
        };

        const sortIconMarkup = ' <i class="fa-solid fa-sort"></i><i class="fa-solid fa-sort-up"></i><i class="fa-solid fa-sort-down"></i>';
        const updateHeaders = (view) => {
            if (view === "harvested") {
                headerDynamic1.textContent = "{{ .lcl.harvest_weight_g }}";
                headerDynamic2.textContent = "{{ .lcl.harvest_date }}";
                // Append sort icons to the headers.
                headerDynamic1.innerHTML += sortIconMarkup;
                headerDynamic2.innerHTML += sortIconMarkup;
                //Set data-sort and data-type for the columns
                headerDynamic1.setAttribute("data-sort", "harvest_weight");
                headerDynamic1.setAttribute("data-type", "number");
                headerDynamic2.setAttribute("data-sort", "harvest_date");
                headerDynamic2.setAttribute("data-type", "date");
            } else if (view === "dead") {
                headerDynamic1.textContent = "{{ .lcl.dead_date }}";
                headerDynamic2.textContent = ""; // Hide second header
                // Append sort icons to the headers.
                headerDynamic1.innerHTML += sortIconMarkup;
                //Set data-sort and data-type for the columns
                headerDynamic1.setAttribute("data-sort", "harvest_date");
                headerDynamic1.setAttribute("data-type", "date");
            } else {
                headerDynamic1.textContent = "{{ .lcl.current_week }}";
                headerDynamic2.textContent = "{{ .lcl.current_day }}";
                // Append sort icons to the headers.
                headerDynamic1.innerHTML += sortIconMarkup;
                headerDynamic2.innerHTML += sortIconMarkup;
                //Set data-sort and data-type for the columns
                headerDynamic1.setAttribute("data-sort", "current_week");
                headerDynamic1.setAttribute("data-type", "number");
                headerDynamic2.setAttribute("data-sort", "current_day");
                headerDynamic2.setAttribute("data-type", "number");
            }
        };

        const formatDateTimeLocal = (date) => {
            const offsetDate = new Date(date.getTime() - date.getTimezoneOffset() * 60000);
            return offsetDate.toISOString().slice(0, 19);
        };

        const initTooltips = () => {
            if (!window.bootstrap || !bootstrap.Tooltip) {
                return;
            }
            document.querySelectorAll('[data-bs-toggle="tooltip"]').forEach((element) => {
                bootstrap.Tooltip.getOrCreateInstance(element);
            });
        };

        const renderQuickActionsCell = (plant) => {
            if (!canEditStatus) {
                return "";
            }
            const statusId = statusIdByName.get(plant.status) || "";
            const encodedName = encodeURIComponent(plant.name || "");
            return `
                <td>
                    <div class="d-inline-flex gap-1">
                        <button type="button" class="btn btn-sm btn-outline-secondary plant-status-edit" data-id="${plant.id}" data-status-id="${statusId}" data-name="${encodedName}" data-bs-toggle="tooltip" data-bs-title="{{ .lcl.change_status }}" aria-label="{{ .lcl.change_status }}">
                            <i class="fa-solid fa-pen-to-square"></i>
                        </button>
                        <button type="button" class="btn btn-sm btn-outline-primary plant-measurement-add" data-id="${plant.id}" data-name="${encodedName}" data-bs-toggle="tooltip" data-bs-title="{{ .lcl.add_measurement }}" aria-label="{{ .lcl.add_measurement }}">
                            <i class="fa-solid fa-ruler-combined"></i>
                        </button>
                        <button type="button" class="btn btn-sm btn-outline-success plant-activity-add" data-id="${plant.id}" data-name="${encodedName}" data-bs-toggle="tooltip" data-bs-title="{{ .lcl.add_activity }}" aria-label="{{ .lcl.add_activity }}">
                            <i class="fa-solid fa-clipboard-list"></i>
                        </button>
                    </div>
                </td>
            `;
        };

        const attachQuickActionHandlers = () => {
            if (!canEditStatus) {
                return;
            }

            document.querySelectorAll(".plant-status-edit").forEach(button => {
                button.addEventListener("click", (event) => {
                    event.stopPropagation();
                    const plantId = Number(button.dataset.id);
                    const statusId = button.dataset.statusId ? Number(button.dataset.statusId) : null;
                    const plantName = decodeURIComponent(button.dataset.name || "");
                    if (!quickStatusModal) {
                        return;
                    }

                    quickStatusPlantIdInput.value = plantId ? String(plantId) : "";
                    quickStatusPlantNameInput.value = plantName;
                    if (statusId) {
                        quickStatusSelect.value = String(statusId);
                    }
                    quickStatusDate.value = formatDateTimeLocal(new Date());
                    quickStatusModal.show();
                });
            });

            document.querySelectorAll(".plant-measurement-add").forEach(button => {
                button.addEventListener("click", (event) => {
                    event.stopPropagation();
                    const plantId = Number(button.dataset.id);
                    const plantName = decodeURIComponent(button.dataset.name || "");
                    if (!quickMeasurementModal || !plantId) {
                        return;
                    }
                    quickMeasurementPlantIdInput.value = String(plantId);
                    quickMeasurementPlantNameInput.value = plantName;
                    quickMeasurementValue.value = "";
                    quickMeasurementDate.value = formatDateTimeLocal(new Date());
                    quickMeasurementModal.show();
                });
            });

            document.querySelectorAll(".plant-activity-add").forEach(button => {
                button.addEventListener("click", (event) => {
                    event.stopPropagation();
                    const plantId = Number(button.dataset.id);
                    const plantName = decodeURIComponent(button.dataset.name || "");
                    if (!quickActivityModal || !plantId) {
                        return;
                    }
                    quickActivityPlantIdInput.value = String(plantId);
                    quickActivityPlantNameInput.value = plantName;
                    quickActivityNote.value = "";
                    quickActivityDate.value = formatDateTimeLocal(new Date());
                    quickActivityModal.show();
                });
            });
        };

        if (canEditStatus && quickStatusForm) {
            quickStatusForm.addEventListener("submit", (event) => {
                event.preventDefault();
                const plantId = Number(quickStatusPlantIdInput.value);
                const statusId = Number(quickStatusSelect.value);
                const date = quickStatusDate.value;

                if (!plantId || !statusId) {
                    return;
                }

                const payload = {
                    plant_id: plantId,
                    status_id: statusId,
                    date: date || formatDateTimeLocal(new Date()),
                };

                fetch("/plant/status", {
                    method: "POST",
                    headers: {
                        "Content-Type": "application/json",
                    },
                    body: JSON.stringify(payload),
                })
                    .then(response => {
                        if (!response.ok) {
                            throw new Error(statusUpdateError);
                        }
                        return response.json();
                    })
                    .then(() => {
                        if (quickStatusModal) {
                            quickStatusModal.hide();
                        }
                        fetchPlants(currentView);
                    })
                    .catch(err => {
                        console.error("Error updating status:", err);
                        uiMessages.showToast(statusUpdateError || uiMessages.t('failed_to_update_status') || 'Failed to update status', 'danger');
                    });
            });
        }

        if (canEditStatus && quickMeasurementForm) {
            quickMeasurementForm.addEventListener("submit", (event) => {
                event.preventDefault();
                const plantId = Number(quickMeasurementPlantIdInput.value);
                const metricId = Number(quickMeasurementMetric.value);
                const value = Number(quickMeasurementValue.value);
                const date = quickMeasurementDate.value;

                if (!plantId || !metricId || Number.isNaN(value)) {
                    return;
                }

                const payload = {
                    plant_id: plantId,
                    metric_id: metricId,
                    value: value,
                    date: date || formatDateTimeLocal(new Date()),
                };

                fetch("/plantMeasurement", {
                    method: "POST",
                    headers: {
                        "Content-Type": "application/json",
                    },
                    body: JSON.stringify(payload),
                })
                    .then(response => {
                        if (!response.ok) {
                            throw new Error(measurementAddError);
                        }
                        return response.json();
                    })
                    .then(() => {
                        if (quickMeasurementModal) {
                            quickMeasurementModal.hide();
                        }
                        fetchPlants(currentView);
                    })
                    .catch(err => {
                        console.error("Error adding measurement:", err);
                        uiMessages.showToast(measurementAddError || uiMessages.t('failed_to_add_measurement') || 'Failed to add measurement', 'danger');
                    });
            });
        }

        if (canEditStatus && quickActivityForm) {
            quickActivityForm.addEventListener("submit", (event) => {
                event.preventDefault();
                const plantId = Number(quickActivityPlantIdInput.value);
                const activityId = Number(quickActivityName.value);
                const note = quickActivityNote.value;
                const date = quickActivityDate.value;

                if (!plantId || !activityId) {
                    return;
                }

                const payload = {
                    plant_id: plantId,
                    activity_id: activityId,
                    note: note,
                    date: date || formatDateTimeLocal(new Date()),
                };

                fetch("/plantActivity", {
                    method: "POST",
                    headers: {
                        "Content-Type": "application/json",
                    },
                    body: JSON.stringify(payload),
                })
                    .then(response => {
                        if (!response.ok) {
                            throw new Error(activityAddError);
                        }
                        return response.json();
                    })
                    .then(() => {
                        if (quickActivityModal) {
                            quickActivityModal.hide();
                        }
                        fetchPlants(currentView);
                    })
                    .catch(err => {
                        console.error("Error adding activity:", err);
                        uiMessages.showToast(activityAddError || uiMessages.t('failed_to_add_activity') || 'Failed to add activity', 'danger');
                    });
            });
        }

        const updateTable = () => {
            const searchTerm = searchPlants.value.toLowerCase();
            let filteredPlants = plantsData.filter(plant =>
                plant.name.toLowerCase().includes(searchTerm) ||
                plant.strain_name.toLowerCase().includes(searchTerm) ||
                plant.breeder_name.toLowerCase().includes(searchTerm)
            );

            // Sort filtered data
            if (sortColumn) {
                filteredPlants.sort((a, b) => {
                    const valA = a[sortColumn];
                    const valB = b[sortColumn];
                    if (valA < valB) return sortDirection === "asc" ? -1 : 1;
                    if (valA > valB) return sortDirection === "asc" ? 1 : -1;
                    return 0;
                });
            }

            // Generate table rows
            plantsTableBody.innerHTML = filteredPlants.map(plant => {
                let column1 = "";
                let column2 = "";

                if (currentView === "harvested") {
                    column1 = plant.harvest_weight ? `${plant.harvest_weight} g` : "-";
                    //Append total days to harvest date from plant.status_date and plant.start_dt
                    column2 = plant.harvest_date ? new Date(plant.harvest_date).toLocaleDateString() + " (" + Math.floor((new Date(plant.harvest_date) - new Date(plant.start_dt)) / (1000 * 60 * 60 * 24) +1) + " days)" : "-";
                } else if (currentView === "dead") {
                    column1 = plant.harvest_date ? new Date(plant.harvest_date).toLocaleDateString()  + " (" + Math.floor((new Date(plant.harvest_date) - new Date(plant.start_dt)) / (1000 * 60 * 60 * 24) +1) + " days)" : "-";
                    column2 = ""; // No second column for dead plants
                } else {
                    column1 = plant.current_week || "-";
                    column2 = plant.current_day || "-";
                }

                return `
                <tr class="clickable-row" data-id="${plant.id}">
                    <th scope="row">${plant.name}</th>
                    <td>
                        ${plant.strain_name}
                        ${plant.strain_url ? `<a href="${plant.strain_url}" target="_blank" class="strain-url"><i class="fa-solid fa-link"></i></a>` : "&nbsp;"}
                    </td>
                    <td>${plant.breeder_name}</td>
                    <td>${plant.status}</td>
                    <td>${plant.start_dt ? new Date(plant.start_dt).toLocaleDateString() : "-"}</td>
                    <td>${column1}</td>
                    <td>${column2}</td>
                    ${renderQuickActionsCell(plant)}
                </tr>
            `;
            }).join("");

            // Add click events for rows
            document.querySelectorAll(".clickable-row").forEach(row => {
                row.addEventListener("click", (event) => {
                    if (event.target.closest(".strain-url") ||
                        event.target.closest(".plant-status-edit") ||
                        event.target.closest(".plant-measurement-add") ||
                        event.target.closest(".plant-activity-add")) {
                        return;
                    }

                    const plantId = row.getAttribute("data-id");
                    if (plantId) window.location.href = `/plant/${plantId}`;
                });
            });
            attachQuickActionHandlers();
            initTooltips();
        };

        // Handle view button click
        viewButtons.forEach(button => {
            button.addEventListener("click", () => {
                currentView = button.dataset.view; // Update current view
                setActiveButton(button); // Update active button visually
                fetchPlants(currentView); // Fetch plants based on selected view
            });
        });

        // Handle column sorting
        document.querySelectorAll(".sortable").forEach(header => {
            header.addEventListener("click", () => {
                const column = header.getAttribute("data-sort");
                if (sortColumn === column) {
                    // Toggle sort direction if already sorted by this column
                    sortDirection = sortDirection === "asc" ? "desc" : "asc";
                } else {
                    // Set new column and reset direction
                    sortColumn = column;
                    sortDirection = "asc";
                }
                document.querySelectorAll(".sortable").forEach(item => {
                    item.classList.remove("asc", "desc");
                });
                header.classList.add(sortDirection);
                updateTable();
            });
        });

        searchPlants.addEventListener("input", updateTable);

        /// Fetch initial data and set active button
        setActiveButton(document.querySelector('.view-button.active'));
        fetchPlants(currentView);
    });
</script>




<!--Embed the footer.html template at this location-->
{{ template "common/footer.html" .}}

{{ end }}